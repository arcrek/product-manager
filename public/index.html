<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Inventory Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                <div>
                    <h1>üì¶ Product Inventory Dashboard</h1>
                    <p class="subtitle">Manage your product inventory with ease</p>
                </div>
                <button onclick="logout()" class="btn btn-secondary" style="margin-top: 10px;">
                    üö™ Logout
                </button>
            </div>
        </header>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-content">
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">Total Products</div>
                </div>
            </div>
            <div class="stat-card success">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <div class="stat-value" id="availableProducts">0</div>
                    <div class="stat-label">Available</div>
                </div>
            </div>
            <div class="stat-card warning">
                <div class="stat-icon">üî•</div>
                <div class="stat-content">
                    <div class="stat-value" id="soldProducts">0</div>
                    <div class="stat-label">Sold</div>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="card">
            <h2>üì§ Upload Products</h2>
            <div class="upload-section">
                <div class="upload-method">
                    <h3>Upload from File</h3>
                    <input type="file" id="fileInput" accept=".txt" class="file-input">
                    <button onclick="uploadFile()" class="btn btn-primary">Upload File</button>
                </div>
                <div class="upload-method">
                    <h3>Paste Text</h3>
                    <textarea id="textInput" placeholder="Enter products (one per line)&#10;Product 1&#10;Product 2&#10;Product 3..." rows="5"></textarea>
                    <button onclick="uploadText()" class="btn btn-primary">Upload Text</button>
                </div>
            </div>
            <div id="uploadResult" class="result"></div>
        </div>

        <!-- Products List -->
        <div class="card">
            <div class="card-header">
                <h2>üìã Products List</h2>
                <div class="controls">
                    <select id="statusFilter" onchange="filterProducts()" class="select">
                        <option value="all">All Products</option>
                        <option value="available">Available Only</option>
                        <option value="sold">Sold Only</option>
                    </select>
                    <button onclick="refreshProducts()" class="btn btn-secondary">üîÑ Refresh</button>
                    <button onclick="showDeleteByDateModal()" class="btn btn-danger">üìÖ Delete by Date</button>
                    <button onclick="bulkDelete()" class="btn btn-danger" id="bulkDeleteBtn" style="display:none;">üóëÔ∏è Delete Selected</button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="table" id="productsTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                            <th>ID</th>
                            <th>Product</th>
                            <th>Upload Date</th>
                            <th>Status</th>
                            <th>Order ID</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productsBody">
                        <tr>
                            <td colspan="7" class="loading">Loading products...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="grid-2">
            <div class="card">
                <h2>üì• Recent Uploads</h2>
                <div id="recentUploads" class="activity-list">
                    <div class="loading">Loading...</div>
                </div>
            </div>
            <div class="card">
                <h2>üí∞ Recent Sales</h2>
                <div id="recentSales" class="activity-list">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>

        <!-- API Keys Management -->
        <div class="card">
            <div class="card-header">
                <h2>üîë API Keys Management</h2>
                <div class="controls">
                    <button onclick="showCreateKeyModal()" class="btn btn-primary">üì• Import API Key</button>
                </div>
            </div>

            <div class="api-keys-stats" style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div class="mini-stat">
                    <span class="mini-stat-value" id="totalKeys">0</span>
                    <span class="mini-stat-label">Total Keys</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-value" id="activeKeys">0</span>
                    <span class="mini-stat-label">Active</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-value" id="totalRequests">0</span>
                    <span class="mini-stat-label">Total Requests</span>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Key</th>
                            <th>Status</th>
                            <th>Usage</th>
                            <th>Last Used</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="apiKeysBody">
                        <tr>
                            <td colspan="7" class="loading">Loading API keys...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Telegram Notifications Settings -->
        <div class="card">
            <div class="card-header">
                <h2>üì± Telegram Notifications</h2>
                <div class="controls">
                    <button onclick="checkStockNow()" class="btn btn-primary">üîç Check Now</button>
                    <button onclick="toggleChecker()" class="btn btn-secondary" id="toggleCheckerBtn">‚è∏Ô∏è Stop</button>
                </div>
            </div>

            <div class="telegram-settings">
                <div class="form-group">
                    <label for="telegram_enabled">
                        <input type="checkbox" id="telegram_enabled" onchange="toggleTelegramSettings()"> 
                        Enable Telegram Notifications
                    </label>
                </div>

                <div id="telegramConfig" style="display:none;">
                    <div class="form-group">
                        <label for="telegram_bot_token">Bot Token</label>
                        <input type="text" id="telegram_bot_token" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11">
                        <small>Get from @BotFather on Telegram</small>
                    </div>

                    <div class="form-group">
                        <label for="telegram_chat_id">Chat ID</label>
                        <input type="text" id="telegram_chat_id" placeholder="-1001234567890">
                        <small>Your group/channel ID (use @userinfobot)</small>
                    </div>

                    <div class="form-group">
                        <label for="stock_threshold">Low Stock Threshold</label>
                        <input type="number" id="stock_threshold" value="10" min="1" max="100">
                        <small>Send alert when stock is below this number</small>
                    </div>

                    <div class="form-group">
                        <label for="check_interval">Stock Level Check Interval</label>
                        <select id="check_interval" class="select">
                            <option value="*/5 * * * *">Every 5 minutes</option>
                            <option value="*/15 * * * *">Every 15 minutes</option>
                            <option value="*/30 * * * *" selected>Every 30 minutes</option>
                            <option value="0 * * * *">Every hour</option>
                            <option value="0 */3 * * *">Every 3 hours</option>
                            <option value="0 */6 * * *">Every 6 hours</option>
                        </select>
                        <small>How often to check for low stock/out of stock alerts</small>
                    </div>

                    <div class="form-group">
                        <label style="font-weight: 600; margin-bottom: 10px; display: block;">Notification Events (Real-time)</label>
                        <label for="notify_on_add" style="display: block; margin-bottom: 8px;">
                            <input type="checkbox" id="notify_on_add"> 
                            Notify when products are added (immediate)
                        </label>
                        <label for="notify_on_sold">
                            <input type="checkbox" id="notify_on_sold"> 
                            Notify when products are sold (immediate)
                        </label>
                        <small style="display: block; margin-top: 10px; color: #666;">
                            ‚ö° These notifications are sent instantly when events occur, not on check interval
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="telegram_header">Message Header (HTML supported)</label>
                        <input type="text" id="telegram_header" placeholder="üè™ <b>Your Store Name</b>">
                        <small>Appears at the top of every notification (optional)</small>
                    </div>

                    <div class="form-group">
                        <label for="telegram_footer">Message Footer (HTML supported)</label>
                        <input type="text" id="telegram_footer" placeholder="üíª Powered by Your Brand">
                        <small>Appears at the bottom of every notification (optional)</small>
                    </div>

                    <div class="button-group">
                        <button onclick="testTelegram()" class="btn btn-secondary">üì§ Send Test</button>
                        <button onclick="saveTelegramSettings()" class="btn btn-primary">üíæ Save Settings</button>
                    </div>
                </div>

                <div id="checkerStatus" class="status-box" style="margin-top: 15px; display:none;">
                    <h3>Status</h3>
                    <div id="statusContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Create API Key Modal -->
    <div id="createKeyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì• Import API Key</h2>
                <button onclick="closeCreateKeyModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="keyValue">API Key *</label>
                    <input type="text" id="keyValue" placeholder="Enter your API key here" style="font-family: monospace;">
                    <small>Enter the API key you want to use (e.g., 17e7068f-f366-4120-83e3-e0ec1212da49)</small>
                </div>

                <div class="form-group">
                    <label for="keyName">Key Name *</label>
                    <input type="text" id="keyName" placeholder="e.g., Production Key, Mobile App, Partner API">
                    <small>A friendly name to identify this key</small>
                </div>

                <div class="form-group">
                    <label for="keyDescription">Description (Optional)</label>
                    <textarea id="keyDescription" rows="3" placeholder="Purpose of this key, who uses it, etc."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeCreateKeyModal()" class="btn btn-secondary">Cancel</button>
                <button onclick="createApiKey()" class="btn btn-primary" id="createKeyBtn">üì• Import Key</button>
            </div>
        </div>
    </div>

    <!-- Edit API Key Modal -->
    <div id="editKeyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Edit API Key</h2>
                <button onclick="closeEditKeyModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editKeyId">
                
                <div class="form-group">
                    <label for="editKeyName">Key Name *</label>
                    <input type="text" id="editKeyName">
                </div>

                <div class="form-group">
                    <label for="editKeyDescription">Description</label>
                    <textarea id="editKeyDescription" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label for="editKeyActive">
                        <input type="checkbox" id="editKeyActive"> 
                        Active (key can be used)
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeEditKeyModal()" class="btn btn-secondary">Cancel</button>
                <button onclick="saveApiKey()" class="btn btn-primary">üíæ Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete by Date Modal -->
    <div id="deleteByDateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÖ Delete Unsold Products by Upload Date</h2>
                <button onclick="closeDeleteByDateModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Delete all <strong>unsold products</strong> uploaded before a specific date.</p>
                <div class="form-group">
                    <label for="deleteBeforeDate">Delete products uploaded before:</label>
                    <input type="date" id="deleteBeforeDate" class="date-input">
                </div>
                <div class="alert" id="deleteByDateInfo" style="display: block; background: #fef3c7; color: #92400e; border-color: #fde68a;">
                    ‚ö†Ô∏è This will only delete <strong>available/unsold</strong> products. Sold products will not be deleted.
                </div>
                <div id="deleteByDatePreview"></div>
            </div>
            <div class="modal-footer">
                <button onclick="closeDeleteByDateModal()" class="btn btn-secondary">Cancel</button>
                <button onclick="previewDeleteByDate()" class="btn btn-primary">üîç Preview</button>
                <button onclick="confirmDeleteByDate()" class="btn btn-danger" id="confirmDeleteBtn" style="display:none;">üóëÔ∏è Confirm Delete</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>

